---
alwaysApply: true
---
# Typecho 博客项目开发规则

## 工作文件夹规则

- **@log** 文件夹是 AI Agent 的专用工作文件夹
- 所有日志文件、临时文件、分析报告等必须存放在 **@log** 文件夹中
- 项目根目录及其他目录中不得存放任何对网站运行无关的文件
- ✅ **允许**：在 @log 文件夹中创建任何工作文件
- ❌ **禁止**：在项目根目录或其他目录创建日志、临时文件
- ❌ **禁止**：修改或删除网站运行必需的文件（除非明确要求）

## 项目结构

### 核心目录
- `admin/` - 后台管理目录（Typecho 核心）
- `usr/plugins/` - 插件目录
  - `CustomMusicPlayer/` - 自定义音乐播放器插件
  - `HelloWorld/` - HelloWorld 插件
  - `SmartSpam/` - 智能反垃圾评论插件
- `usr/themes/` - 主题目录
  - `Daydream/` - 当前使用的主题
  - `default/` - 默认主题
- `usr/uploads/` - 用户上传文件（按年月组织）
- `var/` - Typecho 核心代码库
- `myvault/` - 知识库系统（Perlite），除非明确要求，不修改此目录内容

### 重要文件
- `config.inc.php` - 数据库配置，包含敏感信息，修改需谨慎
- `index.php` - 网站入口文件，Typecho 核心

## 修改规则

### 主题修改
- 主题文件位于：`usr/themes/Daydream/`
- 主要文件：`index.php`, `post.php`, `page.php`, `header.php`, `footer.php`, `functions.php`, `assets/css/style.css`, `assets/js/`
- **原则**：
  1. 备份原则：重大修改前，在 @log 文件夹中记录修改内容
  2. 测试原则：修改后确保不影响网站正常功能
  3. 兼容原则：保持与 Typecho 核心的兼容性
  4. 性能原则：避免影响网站加载速度

### 插件修改
- 插件文件位于：`usr/plugins/[插件名]/`
- 每个插件包含：`Plugin.php` 主文件和其他支持文件
- **原则**：
  1. 激活检查：修改前确认插件是否激活
  2. 钩子函数：了解插件使用的 Typecho 钩子
  3. 数据安全：修改涉及数据库操作时需谨慎
  4. 向后兼容：保持插件配置的兼容性

### 配置文件修改
- `config.inc.php` - 包含数据库连接信息
- **原则**：
  1. 备份优先：修改前备份到 @log 文件夹
  2. 语法检查：确保 PHP 语法正确
  3. 权限检查：确保文件权限正确（通常 644）

### 上传文件管理
- `usr/uploads/` - 按年月组织（如：2024/08/）
- **原则**：
  1. 不删除：除非明确要求，不删除用户上传的文件
  2. 不移动：保持文件路径结构
  3. 记录变更：文件操作记录在 @log 中

## 日志和记录规范

### 日志文件命名
- 格式：`YYYY-MM-DD_[操作描述].log` 或 `YYYY-MM-DD_[操作描述].md`
- 示例：`2025-11-19_主题修改.log`, `2025-11-19_插件调试.md`

### 日志内容要求
- 记录修改时间
- 记录修改的文件和位置
- 记录修改内容（代码片段）
- 记录修改原因
- 记录测试结果

### 日志存放位置
- 所有日志文件必须存放在 `@log/` 文件夹中
- 可以创建子文件夹分类管理（如：`@log/themes/`, `@log/plugins/`）

## 代码规范

### PHP 代码
- 遵循 PSR 标准（如适用）
- 保持代码可读性
- 添加必要的注释
- 避免硬编码，使用配置或常量

### CSS/JavaScript
- 保持代码格式统一
- 避免全局变量污染
- 使用有意义的类名和变量名
- 压缩前保留未压缩版本（如需要）

### 数据库操作
- 使用 Typecho 提供的数据库接口
- 避免直接 SQL 查询（除非必要）
- 注意 SQL 注入防护
- 重要操作前备份数据

## 修改流程

1. **分析需求** → 在 @log 中记录分析结果
2. **制定方案** → 在 @log 中记录修改方案
3. **备份文件** → 备份到 @log 文件夹
4. **执行修改** → 修改代码
5. **记录变更** → 在 @log 中记录详细变更
6. **测试验证** → 记录测试结果


## Git 版本控制

- 项目已连接 GitHub 仓库
- 重要修改后考虑提交到 Git
- Git 提交信息使用 UTF-8 编码
- **@log 文件夹已配置为不参与 Git 同步**（通过 .gitignore）
  - 所有 @log 文件夹中的文件不会被提交到 GitHub
  - 这确保了在线仓库不包含 Agent 操作日志等临时文件

## 性能考虑

- 避免在循环中执行数据库查询
- 合理使用缓存
- 优化图片和静态资源
- 避免阻塞操作

## 常用操作

### 修改主题样式
1. 定位到 `usr/themes/Daydream/assets/css/style.css`
2. 在 @log 中记录修改位置和内容
3. 修改 CSS 代码
4. 测试页面显示效果
5. 记录测试结果

### 添加插件功能
1. 分析插件代码结构（记录在 @log）
2. 确定修改位置
3. 备份原文件到 @log
4. 修改插件代码
5. 测试插件功能
6. 记录修改日志

### 调试问题
1. 在 @log 中创建调试日志文件
2. 记录问题现象
3. 记录排查步骤
4. 记录解决方案
5. 记录最终结果

